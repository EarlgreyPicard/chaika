<?xml version="1.0"?>
<postFilter>
	<title>拡張機能リスト</title>
	<description>インストールしている拡張機能を挿入する</description>
	<version>1.0.0</version>
	<creator>flyson</creator>
	<script><![CDATA[
		const Ci = Components.interfaces;
		const Cc = Components.classes;

		var gRDFS = Cc["@mozilla.org/rdf/rdf-service;1"].getService(Ci.nsIRDFService);
		var gExtensionManager = Cc["@mozilla.org/extensions/manager;1"].getService(Ci.nsIExtensionManager);

		function getExtensionList(){
			var result = new Array();
			var itemList = gExtensionManager.getItemList(Ci.nsIUpdateItem.TYPE_EXTENSION, {});

			for(var [key, value] in Iterator(itemList)){
				var line = value.name + " : " + value.version;
				if(itemIsDisabled(value.id)){
					line += " (無効)";
				}
				result.push(line);
			}
			return result.join("\n");
		}

		function itemIsDisabled(aID){
			const PREFIX_NS_EM = "http://www.mozilla.org/2004/em-rdf#";
			const PREFIX_ITEM_URI = "urn:mozilla:item:";	

			var item = gRDFS.GetResource(PREFIX_ITEM_URI + aID);
			var property = gRDFS.GetResource(PREFIX_NS_EM + "isDisabled")
			var target = gExtensionManager.datasource.GetTarget(item, property, true)
							.QueryInterface(Ci.nsIRDFLiteral);
			return target.Value == "true";
		}

		PostFilter.result += "\n" + getExtensionList();

	]]></script>
</postFilter>